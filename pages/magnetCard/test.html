<!DOCTYPE html>
<html lang="en" dir="rtl">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trivia Test</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .answer-button {
      display: block;
      width: 100%;
      padding: 10px;
      margin: 5px 0;
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 5px;
      cursor: pointer;
      background-color: #f8f9fa;
      transition: background-color 0.3s;
    }

    .answer-button:hover {
      background-color: #e2e6ea;
    }

    .header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      font-weight: bold;
    }

    #timer {
      font-size: 1.5rem;
    }

    #testName {
      font-size: 1.3rem;
    }

    #questionProgress {
      font-size: 1.5rem;
    }

    .modal-lg {
      max-width: 800px;
    }

    .modal {
      pointer-events: none;
    }

    .modal-dialog {
      pointer-events: all;
    }
  </style>
</head>

<body>

  <!-- Modal for Trivia Test -->
  <div class="modal fade" id="triviaModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false"
    aria-labelledby="triviaModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-body">
          <div class="header-container">
            <p id="timer" class="text-start"></p>
            <p id="testName" class="text-center"></p>
            <p id="questionProgress" class="text-end"></p>
          </div>
          <div id="questionContainer">
            <!-- Single question will be dynamically injected here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Result Modal -->
  <div class="modal fade" id="resultModal" tabindex="-1" aria-labelledby="resultModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="resultModalLabel">Test Results</h5>
        </div>
        <div class="modal-body">
          <p id="resultText"></p>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Data Structure for Trivia Tests
    const triviaTests = [
      {
        id: 510000001,
        title: "General Knowledge",
        questions: [
          { question: "What is the capital of Israel?", answers: ["Tel Aviv", "Jerusalem", "Haifa"], correctIndex: 1 },
          { question: "What is 5 times 3?", answers: ["15", "10", "20"], correctIndex: 0 },
          { question: "Which animal is considered the king of the jungle?", answers: ["Elephant", "Lion", "Tiger"], correctIndex: 1 }
        ]
      },
      {
        id: 510000003,
        title: "Science Trivia",
        questions: [
          { question: "What is H2O?", answers: ["Oxygen", "Water", "Hydrogen"], correctIndex: 1 },
          { question: "What is the speed of light?", answers: ["300,000 km/s", "150,000 km/s", "1,000,000 km/s"], correctIndex: 0 },
          { question: "What does DNA stand for?", answers: ["Deoxyribonucleic Acid", "Dynamic Nucleic Acid", "Duplex Nucleic Acid"], correctIndex: 0 }
        ]
      }
    ];
    // שליפת קוד מבחן מתוך ה-URL
    function getTestIdFromUrl() {
      const params = new URLSearchParams(window.location.search);
      return parseInt(params.get('testId'), 10);
    }

    // טענת מבחן בהתאם לקוד
    window.onload = () => {
      const testId = getTestIdFromUrl();
      const selectedTest = triviaTests.find(test => test.id === testId);

      if (selectedTest) {
        openTest(selectedTest);
      } else {
        alert("Test not found!");
      }
    };    

    // Open a Specific Test in the Modal
    const questionContainer = document.getElementById('questionContainer');
    const questionProgress = document.getElementById('questionProgress');
    const testNameElement = document.getElementById('testName');
    const timerElement = document.getElementById('timer');
    let currentTest = null;
    let currentQuestionIndex = 0;
    let correctCount = 0;
    let timer;

    function openTest(test) {
      currentTest = test;
      currentQuestionIndex = 0;
      correctCount = 0;
      testNameElement.innerText = `${test.title}`;
      displayQuestion();

      // Show Modal
      const triviaModal = new bootstrap.Modal(document.getElementById('triviaModal'));
      triviaModal.show();
    }

    function displayQuestion() {
      const questionData = currentTest.questions[currentQuestionIndex];
      questionContainer.innerHTML = `
        <div class="mb-3">
          <p><strong>${questionData.question}</strong></p>
          ${questionData.answers.map((answer, i) => `
            <div class="answer-button" onclick="submitAnswer(${i})">${answer}</div>
          `).join('')}
        </div>
      `;
      questionProgress.innerText = `${currentQuestionIndex + 1}/${currentTest.questions.length}`;
      startTimer();
    }

    function startTimer() {
      let timeLeft = 8;
      timerElement.innerText = `Time left: ${timeLeft}s`;
      clearInterval(timer);
      timer = setInterval(() => {
        timeLeft--;
        timerElement.innerText = `Time left: ${timeLeft}s`;
        if (timeLeft <= 0) {
          clearInterval(timer);
          submitAnswer(-1); // Auto move to next question if no answer selected
        }
      }, 1000);
    }

    function submitAnswer(selectedIndex) {
      clearInterval(timer);
      if (selectedIndex === currentTest.questions[currentQuestionIndex].correctIndex) {
        correctCount++;
      }

      currentQuestionIndex++;

      if (currentQuestionIndex < currentTest.questions.length) {
        displayQuestion();
      } else {
        showResults();
      }
    }

    function showResults() {
      const resultText = `You answered ${correctCount} out of ${currentTest.questions.length} questions correctly. Total points: ${correctCount * 10}`;
      document.getElementById('resultText').innerText = resultText;

      // Close Trivia Modal
      const triviaModalEl = document.getElementById('triviaModal');
      const triviaModal = bootstrap.Modal.getInstance(triviaModalEl);
      triviaModal.hide();

      // Show Result Modal
      const resultModal = new bootstrap.Modal(document.getElementById('resultModal'));
      resultModal.show();
    }
  </script>
</body>

</html>