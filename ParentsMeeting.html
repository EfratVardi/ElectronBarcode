<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>אסיפת הורים</title>
  <style>
    @font-face {
      font-family: printFont;
      src: url("fonts/FbMagnolia-Regular.otf");
    }

    #d1 {
      font-family: printFont;
      direction: rtl;
      font-size: 20px;
    }

    #title {
      font-family: printFont;
      direction: rtl;
      font-size: 25px;
    }

    #header {
      font-family: printFont;
      direction: rtl;
      font-size: 35px;
    }
  </style>
</head>

<body onload="onLoad()">
  <link rel="stylesheet" href="./node_modules/bootstrap/dist/css/bootstrap.min.css">
  <link href="StyleSheets/ParentsMeetingStyleSheet.css" rel="stylesheet" />
  <link href="StyleSheets/MainStyleSheet.css" rel="stylesheet" />
  <script src="js/ag-grid-community.min.js"></script>
  <script src="js/jquery.min.js"></script>
  <script src="./node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
  <script src="js/shared.js"></script>

  <script>
    var currentDate = getTodayDate()
    var currentDateTime = getTodayDateTime()
    var systemConfig = ""
    var searchVal
    var counter = 0;
    var state = 1

    function onLoad() {
      fileName = 'systemConfig'
      window.expose.SendExcel("sendReadExcel", fileName);
      window.expose.ReceiveExcel("receiveReadExcel" + fileName, (data) => {
        if (data == 0) {
          systemConfig = getDefaultConfig()
        }
        else {
          systemConfig = JSON.parse(data)
        }
        if (systemConfig.color == "1") {
          document.getElementById("background").style.backgroundImage = "url('resources/parentsMeeting/pinkBackground1.gif')"
        }
        else if (systemConfig.color == "2") {
          document.getElementById("background").style.backgroundImage = "url('resources/parentsMeeting/greenBackground1.gif')";
        }
      })
    }

    document.addEventListener("keypress", function (e) {
      if (e.target.tagName !== "INPUT" && state == 1) {
        var input = document.querySelector(".my-input");
        input.focus();
        input.value = e.key;
        e.preventDefault();
      }
      counter += 1;
      if (counter > 9 && state == 1) {
        searchVal = document.getElementById('barcode').value
        counter = 0;
        document.getElementById("barcode").value = "";
        if (searchVal == '999999999')
          login('Manage')
        else if (searchVal == '011429519')
          login('System')
        else if (searchVal == '207594581')
          login('Main')
        else if (searchVal == '121212121')
          start();
        else {
          showAlert("קוד לא תקין, גשי למורה!");
          return;
        }
      }
    });

    function start() {
      state = 2
      systemConfig.color == 1 ?
        document.getElementById("background").style.backgroundImage = "url('resources/parentsMeeting/pinkBackground2.gif')" :
        document.getElementById("background").style.backgroundImage = "url('resources/parentsMeeting/greenBackground2.gif')";
      document.getElementById("line1").innerHTML = "";
      document.getElementById("line2").innerHTML = ":כתבי כאן";
      document.getElementById("text").style.top = "5%";
      document.getElementById("form").style.display = "inline"
    }

    function toPrint(task) {
      var divName = "printableArea";
      document.getElementById("d1").innerHTML = document.getElementById("content").value
      var printContents = document.getElementById(divName).innerHTML;
      var originalContents = document.body.innerHTML;
      document.body.innerHTML = printContents;
      window.expose.send("sendPrint", "");
      window.expose.receive("receivePrint", (data) => {
        document.body.innerHTML = originalContents;
        document.getElementById("form").style.display = "none"
        systemConfig.color == 1 ? document.getElementById("background").style.backgroundImage = "url('resources/parentsMeeting/pinkBackground3.gif')"
          : document.getElementById("background").style.backgroundImage = "url('resources/parentsMeeting/greenBackground3.gif')";
        document.getElementById("text").style.top = "20%";
        document.getElementById("line1").innerHTML = "! תודה רבה";
        document.getElementById("line2").innerHTML = "...אל תשכחי לקחת את הפתק מהמדפסת";
        reset(2500);
      });
    }

    function reset(time = 0) {
      setTimeout(function () {
        location.reload();
      }, time);
    }

    function showAlert(message) {
      document.querySelector(".modal-body").innerHTML = message;
      $(document).ready(function () {
        $('#modal').modal('show')
      });
      setTimeout(function () {
        $(document).ready(function () {
          $('#modal').modal('hide')
        });
      }, 2500);
      reset(2500)
    }
  </script>
  <div id="printableArea" style="display: none;">
    <div id="header">פתק מאמא</div>
    <br />
    <br />
    <div id="title">ברגעים של נחת,</div>
    <div id="title">כשהדיווחים באמתחת,</div>
    <div id="title">רציתי להוסיף כמה מילים משלי-</div>
    <div id="title">כי את הכל בשבילי!</div>
    <br />
    <br />
    <div id="d1"> </div>
    <br /><br /><br />
    <div id="d4" style="font-size:10px; font-family: Arial, Helvetica, sans-serif; direction: rtl;">להזמנות: אפרת מלכה
      0504167969 211efrat@gmail.com
    </div>
  </div>

  <div class="background" id="background">
    <div class="text" id="text">
      <div id="line1">!אמא יקרה</div>
      <div id="line2">
        ...מוזמנת לסרוק את הברקוד ולהוסיף כמה מילים טובות של אמא
      </div>
      <form id="form" style="display: none;direction: rtl;">
        <div class="form-group col-md-10" style="padding-left: 16.666%; ">
          <textarea id="content" class="form-control" rows="6"></textarea>
        </div>
        <div class="form-group col-md-8" style="padding-left: 33.33%;">
          <button onclick="toPrint(1)" id="btnPrint" class="form-control">שליחה
            להדפסה</button>
        </div>
      </form>
    </div>
    <input type="text" class="my-input" id="barcode">
  </div>

  <div class="modal fade" style="direction: rtl" id="modal" tabindex="-1" role="dialog" aria-labelledby="modalLabel"
    aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalLabel">הודעת מערכת</h5>
        </div>
        <div class="modal-body"></div>
      </div>
    </div>
  </div>
</body>

</html>