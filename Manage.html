<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>ממשק ניהול</title>
</head>

<body onload="onLoad()">
    <link href="StyleSheets/manageStyleSheet.css" rel="stylesheet" />
    <link href="StyleSheets/MainStyleSheet.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/ag-grid-community.min.js"></script>
    <script src="js/ag-grid.js"></script>
    <script src="js/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script>
        var counter = 0;
        var systemConfig;

        function onLoad() {
            window.expose.SendReadExcel("sendReadExcel", "systemConfig");
            window.expose.ReceiveReadExcel("receiveReadExcel", (data) => {
                systemConfig = JSON.parse(data)
                systemConfig.color == "1" ? document.getElementById("background").style.backgroundImage = "url('resources/pinkBackground4.gif')" : document.getElementById("background").style.backgroundImage = "url('resources/greenBackground4.gif')";
            })
        }

        document.addEventListener("keypress", function (e) {
            if (e.target.tagName !== "INPUT") {
                var input = document.querySelector(".my-input");
                input.focus();
                input.value = e.key;
                e.preventDefault();
            }
            counter += 1;
            if (counter > 9) {
                if (document.getElementById('barcode').value == '999999999')
                    login("User")
                if (document.getElementById('barcode').value == '011429519')
                    login("System")
            }
        });

        function login(page) {
            counter = 0;
            window.location.href = page + '.html';
        }
        function New() {
            window.expose.SendExcel("sendReadExcel", "studentsExcel");
            window.expose.ReceiveExcel("receiveReadExcel", (data) => {
                var students = JSON.parse(data)
                var tz = Math.floor(Math.random() * (399999999 - 200000000 + 1) + 200000000)
                for (var i = 0; i < students.length; i++) {
                    while (students[i]["tz"] == tz) {
                        tz = Math.floor(Math.random() * (399999999 - 200000000 + 1) + 200000000)
                        i = 0
                    }
                }
                students.unshift({
                    grade: '------', name: '------', tz: tz, barcode: '',
                    points: 0, tasks: ",", tasksNumber: ",", dates: '[]'
                })
                window.expose.SendExcel("sendWriteExcel", JSON.stringify(students));
                window.expose.ReceiveExcel("receiveWriteExcel", (data) => {
                    // expose.writeToFile("studentsExcel",JSON.stringify(students) )
                    if(data==1)
                        location.reload()
                });
            });
        }

    </script>
    <div class="background" id="background">
        <div class="text">
            <div id="line1">ברוכה הבאה לממשק ניהול</div>
            <div id="line2">כאן אפשר לצפות, לערוך ולהוריד את הנתונים</div>
            <img style="margin-left: 10px;" onclick="Export('ניקוד תלמידות')" src="resources/file-earmark-excel.svg" />
            <img style="margin-left: 10px;" onclick="New()" src="resources/person-plus.svg" />
            <img onclick="expose.appClose()" src="resources/box-arrow-left.svg" />
            <div id="studentsGrid" style="width:100%" class="ag-theme-alpine"></div>
        </div>
        <input type="text" class="my-input" id="barcode">
    </div>
</body>

</html>